(()=>{var x=(()=>{let d=a=>String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),p=(a,b)=>{let y=null;y=setTimeout(()=>{a(),clearTimeout(y),y=null},b)};return{copy:async(a,b=null,y=1500)=>{let $=a.getAttribute("data-copy");if(!$||$.length==0){alert("Nothing to copy");return}a.disabled=!0;try{await navigator.clipboard.writeText($)}catch{a.disabled=!1,alert("Failed to copy");return}let c=a.innerHTML;a.innerHTML=b||'<i class="fa-solid fa-check"></i>',p(()=>{a.disabled=!1,a.innerHTML=c},y)},timeOut:p,escapeHtml:d,base64Encode:a=>{let y=new TextEncoder().encode(a);return window.btoa(String.fromCharCode(...y))},base64Decode:a=>{let b=new TextDecoder,y=Uint8Array.from(window.atob(a),$=>$.charCodeAt(0));return b.decode(y)},disableButton:(a,b="Loading")=>{a.disabled=!0;let y=a.innerHTML;return a.innerHTML=`<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem"></span>${b}`,{restore:()=>{a.innerHTML=y,a.disabled=!1}}},disableCheckbox:a=>{a.disabled=!0;let b=document.querySelector(`label[for="${a.id}"]`),y=b.innerHTML;return b.innerHTML=`<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem"></span>${y}`,{restore:()=>{b.innerHTML=y,a.disabled=!1}}},parseUserAgent:a=>{let b=[{type:"Mobile",regex:/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i},{type:"Tablet",regex:/iPad|Android(?!.*Mobile)/i},{type:"Desktop",regex:/Windows NT|Macintosh|Linux/i}],y=[{name:"Chrome",regex:/Chrome|CriOS/i},{name:"Safari",regex:/Safari/i},{name:"Edge",regex:/Edg|Edge/i},{name:"Firefox",regex:/Firefox|FxiOS/i},{name:"Opera",regex:/Opera|OPR/i},{name:"Internet Explorer",regex:/MSIE|Trident/i}],$=[{name:"Windows",regex:/Windows NT ([\d.]+)/i},{name:"MacOS",regex:/Mac OS X ([\d_]+)/i},{name:"Android",regex:/Android ([\d.]+)/i},{name:"iOS",regex:/OS ([\d_]+) like Mac OS X/i},{name:"Linux",regex:/Linux/i}],c=b.find(M=>M.regex.test(a))?.type||"Unknown",s=y.find(M=>M.regex.test(a))?.name||"Unknown",f=$.find(M=>M.regex.test(a)),v=f&&a.match(f.regex)?.[1]?.replace(/_/g,".")||"",I=f?f.name:"Unknown";return v=v?`${I} ${v}`:I,`${s} ${c} ${v}`}}})();var A=(()=>{let d=(c,s,f)=>({code:c,data:s,error:f}),p=(c=0)=>({love:c}),h=({uuid:c,own:s,name:f,presence:v,comment:I,created_at:M,is_admin:O,ip:i,user_agent:t,comments:g,like:e})=>({uuid:c,own:s,name:f,presence:v,comment:I,created_at:M,is_admin:O??!1,ip:i,user_agent:t,comments:g?.map(h)??[],like:p(e?.love??0)});return{uuidResponse:({uuid:c})=>({uuid:c}),baseResponse:d,tokenResponse:({token:c})=>({token:c}),statusResponse:({status:c})=>({status:c}),commentResponse:({name:c,presence:s,comment:f,is_admin:v,created_at:I})=>({name:c,presence:s,comment:f,is_admin:v,created_at:I}),likeCommentResponse:p,getCommentResponse:h,getCommentsResponse:c=>c.map(h),commentShowMore:(c,s=!1)=>({uuid:c,show:s}),postCommentRequest:(c,s,f,v)=>({id:c,name:s,presence:f,comment:v}),postSessionRequest:(c,s)=>({email:c,password:s}),updateCommentRequest:(c,s)=>({presence:c,comment:s})}})();var E=d=>{let p=(r=null)=>{let w=JSON.parse(localStorage.getItem(d));return r?w[String(r)]:w},h=(r,w)=>{let a=p();a[String(r)]=w,localStorage.setItem(d,JSON.stringify(a))},l=r=>Object.keys(p()).includes(String(r)),o=r=>{if(!l(r))return;let w=p();delete w[String(r)],localStorage.setItem(d,JSON.stringify(w))},m=()=>localStorage.setItem(d,"{}");return localStorage.getItem(d)||m(),{set:h,get:p,has:l,clear:m,unset:o}};var q="GET",V="PUT",U="POST",N="PATCH",K="DELETE",B=(d,p)=>{let h=document.body.getAttribute("data-url"),l={method:String(d).toUpperCase(),headers:new Headers({Accept:"application/json","Content-Type":"application/json"})};return h.slice(-1)==="/"&&(h=h.slice(0,-1)),{send(o=null){return fetch(h+p,l).then(m=>m.json().then(r=>{if(m.status>=500&&(r.message??r[0]))throw new Error(r.message??r[0]);if(r.error)throw new Error(r.error[0]);return o&&(r.data=o(r.data)),A.baseResponse(r.code,r.data,r.error)})).catch(m=>{throw alert(m),new Error(m)})},download(){return fetch(h+p,l).then(o=>{if(o.status!==200)return!1;let m=document.querySelector("a[download]");m&&document.body.removeChild(m);let r=o.headers.get("content-disposition")?.match(/filename="(.+)"/)?.[1]??"download.csv";return o.blob().then(w=>{let a=document.createElement("a"),b=window.URL.createObjectURL(w);return a.href=b,a.download=r,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(b),!0})}).catch(o=>{throw alert(o),new Error(o)})},token(o){return o.split(".").length===3?(l.headers.append("Authorization","Bearer "+o),this):(l.headers.append("x-access-key",o),this)},body(o){return l.body=JSON.stringify(o),this}}};var T=(()=>{let d=null,p=()=>d.get("token"),h=b=>B(U,"/api/session").body(b).send(A.tokenResponse).then(y=>(y.code===200&&o(y.data.token),y.code===200),()=>!1),l=()=>d.unset("token"),o=b=>d.set("token",b),m=()=>String(p()??".").split(".").length===3;return{init:()=>{d=E("session")},guest:()=>B(q,"/api/config").token(p()).send().then(b=>{if(b.code!==200)return b;let y=E("config");for(let[$,c]of Object.entries(b.data))y.set($,c);return b}),login:h,logout:l,decode:()=>{if(!m())return null;try{return JSON.parse(window.atob(p().split(".")[1]))}catch{return null}},isAdmin:m,setToken:o,getToken:p}})();var F=window.bootstrap;var G=(()=>{let d=null,p=async r=>{let w=x.disableButton(r),a=document.getElementById("loginEmail"),b=document.getElementById("loginPassword");a.disabled=!0,b.disabled=!0,await T.login(A.postSessionRequest(a.value,b.value))&&(a.value=null,b.value=null,F.Modal.getOrCreateInstance("#mainModal").hide()),w.restore(),a.disabled=!1,b.disabled=!1},h=()=>B(q,"/api/user").token(T.getToken()).send().then(r=>{if(r.code!==200)return r;for(let[w,a]of Object.entries(r.data))d.set(w,a);return r},r=>(o(),r)),l=()=>d,o=()=>{d.clear(),T.logout(),F.Modal.getOrCreateInstance("#mainModal").show()};return{init:()=>{d=E("user")},login:p,clearSession:o,getDetailUser:h,getUserStorage:l}})();var X={buttonNavHome:h=>{F.Tab.getOrCreateInstance(document.getElementById("button-home")).show(),h.classList.add("active"),document.getElementById("button-mobile-setting").classList.remove("active")},buttonNavSetting:h=>{F.Tab.getOrCreateInstance(document.getElementById("button-setting")).show(),h.classList.add("active"),document.getElementById("button-mobile-home").classList.remove("active")}};var H=(()=>{let d={"#000000":"#ffffff","#ffffff":"#000000","#212529":"#f8f9fa","#f8f9fa":"#212529"},p=["#ffffff","#f8f9fa"],h=["#000000","#212529"],l=!1,o=null,m=null,r=null,w=null,a=t=>{Object.entries({"text-light":"text-dark","btn-theme-light":"btn-theme-dark","bg-dark":"bg-light","bg-black":"bg-white","bg-theme-dark":"bg-theme-light","color-theme-black":"color-theme-white","btn-outline-light":"btn-outline-dark","bg-cover-black":"bg-cover-white"}).forEach(([e,n])=>{t.classList.contains(e)&&t.classList.replace(e,n)})},b=t=>{Object.entries({"text-dark":"text-light","btn-theme-dark":"btn-theme-light","bg-light":"bg-dark","bg-white":"bg-black","bg-theme-light":"bg-theme-dark","color-theme-white":"color-theme-black","btn-outline-dark":"btn-outline-light","bg-cover-white":"bg-cover-black"}).forEach(([e,n])=>{t.classList.contains(e)&&t.classList.replace(e,n)})},y=()=>o.set("active","light"),$=()=>o.set("active","dark"),c=()=>{y(),document.documentElement.setAttribute("data-bs-theme","light");let t=[".text-light",".btn-theme-light",".bg-dark",".bg-black",".bg-theme-dark",".color-theme-black",".btn-outline-light",".bg-cover-black"].join(", ");document.querySelectorAll(t).forEach(g=>r.observe(g))},s=()=>{$(),document.documentElement.setAttribute("data-bs-theme","dark");let t=[".text-dark",".btn-theme-dark",".bg-light",".bg-white",".bg-theme-light",".color-theme-white",".btn-outline-dark",".bg-cover-white"].join(", ");document.querySelectorAll(t).forEach(g=>w.observe(g))},f=(t=null,g=null)=>{let e=o.get("active")==="dark";return t&&g?e?t:g:e},v=()=>f()?c():s(),I=()=>l,M=()=>{let t=(g,e)=>new IntersectionObserver((n,u)=>{n.filter(L=>L.isIntersecting).forEach(L=>g(L.target)),n.filter(L=>!L.isIntersecting).forEach(L=>g(L.target)),u.disconnect();let k=m.getAttribute("content");m.setAttribute("content",e.some(L=>L===k)?d[k]:k)});r=t(a,h),w=t(b,p)};return{init:()=>{switch(o=E("theme"),m=document.querySelector('meta[name="theme-color"]'),M(),o.has("active")||(window.matchMedia("(prefers-color-scheme: dark)").matches?$():y()),document.body.getAttribute("data-theme")){case"dark":$();break;case"light":y();break;default:l=!0}f()?s():c()},spyTop:()=>{let t=e=>{e.filter(n=>n.isIntersecting).forEach(n=>{let u=["bg-black","bg-white"].some(k=>n.target.classList.contains(k))?f(h[0],p[0]):f(h[1],p[1]);m.setAttribute("content",u)})},g=new IntersectionObserver(t,{rootMargin:"0% 0% -95% 0%"});document.querySelectorAll("section").forEach(e=>g.observe(e))},change:v,isDarkMode:f,isAutoMode:I}})();var Y=(()=>{let d=null,p=!0,h=c=>new Promise(s=>{let f=parseFloat(d.style.opacity),v=null,I=c?.05:-.05,M=c?1:0;v=setInterval(()=>{f=Math.max(0,Math.min(1,f+I)),d.style.opacity=f.toFixed(2),f===M&&(s(),clearInterval(v),v=null)},10)}),l=()=>{let c=null;c=setTimeout(()=>{clearTimeout(c),c=null,p&&r()},3e3)},o=()=>{let c=d.firstElementChild.firstElementChild;c.classList.remove("bg-success"),c.classList.add("bg-danger"),c.firstElementChild.innerHTML='<i class="fa-solid fa-ban me-2"></i>Koneksi tidak tersedia'},m=()=>{let c=d.firstElementChild.firstElementChild;c.classList.remove("bg-danger"),c.classList.add("bg-success"),c.firstElementChild.innerHTML='<i class="fa-solid fa-cloud me-2"></i>Koneksi tersedia kembali'},r=async()=>{await h(!1),o()},w=()=>{let c=["input[data-offline-disabled]","button[data-offline-disabled]","select[data-offline-disabled]","textarea[data-offline-disabled]"].join(", ");document.querySelectorAll(c).forEach(s=>{s.dispatchEvent(new Event(y()?"online":"offline")),s.setAttribute("data-offline-disabled",y()?"false":"true"),s.tagName==="BUTTON"?y()?s.classList.remove("disabled"):s.classList.add("disabled"):y()?s.removeAttribute("disabled"):s.setAttribute("disabled","true")})},a=()=>{p=!1,o(),h(!0),w()},b=()=>{p=!0,m(),l(),w()},y=()=>p;return{init:()=>{window.addEventListener("online",b),window.addEventListener("offline",a),d=document.getElementById("offline-mode"),d.innerHTML=`
        <div class="d-flex justify-content-center mx-auto">
            <div class="d-flex justify-content-center align-items-center rounded-pill my-2 bg-danger shadow">
                <small class="text-center py-1 px-2 mx-1 mt-1 mb-0 text-white" style="font-size: 0.8rem;"></small>
            </div>
        </div>`},isOnline:y}})();var R=(()=>{let d=null,p=null,h=null,l=null,o=null,m=null,r=250,w=()=>`
        <div class="bg-theme-${H.isDarkMode("dark","light")} shadow p-3 mx-0 mt-0 mb-3 rounded-4">
            <div class="d-flex flex-wrap justify-content-between align-items-center placeholder-wave">
                <span class="placeholder bg-secondary col-5 rounded-3 my-1"></span>
                <span class="placeholder bg-secondary col-3 rounded-3 my-1"></span>
            </div>
            <hr class="text-${H.isDarkMode("light","dark")} my-1">
            <p class="placeholder-wave m-0">
                <span class="placeholder bg-secondary col-6 rounded-3"></span>
                <span class="placeholder bg-secondary col-5 rounded-3"></span>
                <span class="placeholder bg-secondary col-12 rounded-3 my-1"></span>
            </p>
        </div>`,a=e=>{let n=H.isDarkMode("light","dark");return[["*",`<strong class="text-${n}">$1</strong>`],["_",`<em class="text-${n}">$1</em>`],["~",`<del class="text-${n}">$1</del>`],["```",`<code class="font-monospace text-${n}">$1</code>`]].forEach(k=>{let L=k[0],_=k[1];e=e.replace(new RegExp(`\\${L}(?=\\S)(.*?)(?<!\\s)\\${L}`,"gs"),_)}),e},b=e=>`
        <button style="font-size: 0.8rem;" onclick="undangan.comment.like.like(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-${H.isDarkMode("light","dark")} ms-auto rounded-3 p-0 shadow-sm d-flex justify-content-start align-items-center" data-offline-disabled="false">
            <span class="my-0 mx-1" data-count-like="${e.like.love}">${e.like.love}</span>
            <i class="me-1 ${h.has(e.uuid)?"fa-solid fa-heart text-danger":"fa-regular fa-heart"}"></i>
        </button>`,y=e=>{let n=H.isDarkMode("light","dark"),u=`<div class="d-flex flex-wrap justify-content-start align-items-center" data-button-action="${e.uuid}">`;return(l.get("can_reply")==!0||l.get("can_reply")===void 0)&&(u+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.reply(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-${n} rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Reply</button>`),p.has(e.uuid)&&(l.get("can_edit")==!0||l.get("can_edit")===void 0)&&(u+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-${n} rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Edit</button>`),T.isAdmin()?u+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-${n} rounded-4 py-0 me-1 shadow-sm" data-own="${e.own}" data-offline-disabled="false">Delete</button>`:p.has(e.uuid)&&(l.get("can_delete")==!0||l.get("can_delete")===void 0)&&(u+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-${n} rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Delete</button>`),u+="</div>",u},$=(e,n)=>{let u=m.get("show").includes(e);return`<a class="text-${H.isDarkMode("light","dark")}" style="font-size: 0.8rem;" onclick="undangan.comment.showOrHide(this)" data-uuid="${e}" data-uuids="${n.join(",")}" data-show="${u?"true":"false"}" role="button" class="me-auto ms-1 py-0">${u?"Hide replies":`Show replies (${n.length})`}</a>`},c=e=>`
        <div class="d-flex flex-wrap justify-content-between align-items-center" id="button-${e.uuid}">
            ${y(e)}
            ${e.comments.length>0?$(e.uuid,e.comments.map(n=>n.uuid)):""}
            ${b(e)}
        </div>`,s=e=>{if(e.ip===void 0||e.user_agent===void 0||e.is_admin)return"";let n=H.isDarkMode("light","dark");return`
        <div class="mb-1 mt-3">
            <p class="text-${n} mb-1 mx-0 mt-0 p-0" style="font-size: 0.7rem;" id="ip-${e.uuid}"><i class="fa-solid fa-location-dot me-1"></i>${x.escapeHtml(e.ip)} ${o.has(e.ip)?`<strong>${o.get(e.ip)}</strong>`:'<span class="mb-1 placeholder col-2 rounded-3"></span>'}</p>
            <p class="text-${n} m-0 p-0" style="font-size: 0.7rem;"><i class="fa-solid fa-mobile-screen-button me-1"></i>${x.parseUserAgent(x.escapeHtml(e.user_agent))}</p>
        </div>`},f=(e,n)=>{let u=H.isDarkMode("dark","light");return n?`class="bg-theme-${u} shadow p-3 mx-0 mt-0 mb-3 rounded-4" data-parent="true"`:`class="${m.get("hidden").find(k=>k.uuid===e.uuid).show?"":"d-none"} overflow-x-scroll mw-100 border-start bg-theme-${u} py-2 ps-2 pe-0 my-2 ms-2 me-0"`},v=(e,n)=>e.is_admin?`<strong class="me-1">${x.escapeHtml(d.get("name")??l.get("name"))}</strong><i class="fa-solid fa-certificate text-primary"></i>`:n?`<strong class="me-1">${x.escapeHtml(e.name)}</strong><i id="badge-${e.uuid}" class="fa-solid ${e.presence?"fa-circle-check text-success":"fa-circle-xmark text-danger"}"></i>`:`<strong>${x.escapeHtml(e.name)}</strong>`,I=(e,n)=>{let u=H.isDarkMode("light","dark"),k=a(x.escapeHtml(e.comment)),L=k.length>r;return`
        <div class="d-flex flex-wrap justify-content-between align-items-center">
            <p class="text-${u} text-truncate m-0 p-0" style="font-size: 0.95rem;">${v(e,n)}</p>
            <small class="text-${u} m-0 p-0" style="font-size: 0.75rem;">${e.created_at}</small>
        </div>
        <hr class="text-${u} my-1">
        <p class="text-${u} my-1 mx-0 p-0" style="white-space: pre-wrap !important; font-size: 0.95rem;" ${L?`data-comment="${x.base64Encode(k)}"`:""} id="content-${e.uuid}">${L?k.slice(0,r)+"...":k}</p>
        ${L?`<p class="mb-2 mt-0 mx-0 p-0"><a class="text-${u}" role="button" style="font-size: 0.85rem; display: block;" data-show="false" onclick="undangan.comment.showMore(this, '${e.uuid}')">Selengkapnya</a></p>`:""}`},M=(e,n)=>`
        <div ${f(e,n)} id="${e.uuid}" style="overflow-wrap: break-word !important;">
            <div id="body-content-${e.uuid}" data-tapTime="0" data-liked="false" tabindex="0">
            ${I(e,n)}
            </div>
            ${s(e)}
            ${c(e)}
            <div id="reply-content-${e.uuid}">${e.comments.map(u=>O(u)).join("")}</div>
        </div>`,O=e=>M(e,!1);return{init:()=>{d=E("user"),p=E("owns"),h=E("likes"),l=E("config"),o=E("tracker"),m=E("comment")},renderEdit:(e,n)=>{let u=document.createElement("div");return u.classList.add("my-2"),u.id=`inner-${e}`,u.innerHTML=`
        <label for="form-inner-${e}" class="form-label my-1" style="font-size: 0.95rem;"><i class="fa-solid fa-pen me-2"></i>Edit</label>
        ${document.getElementById(e).getAttribute("data-parent")==="true"&&!T.isAdmin()?`
        <select class="form-select shadow-sm mb-2 rounded-4" id="form-inner-presence-${e}" data-offline-disabled="false">
            <option value="1" ${n?"selected":""}>Datang</option>
            <option value="2" ${n?"":"selected"}>Berhalangan</option>
        </select>`:""}
        <textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type update comment" rows="3" data-offline-disabled="false"></textarea>
        <div class="d-flex flex-wrap justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel('${e}')" class="btn btn-sm btn-outline-${H.isDarkMode("light","dark")} rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.update(this)" data-uuid="${e}" class="btn btn-sm btn-outline-${H.isDarkMode("light","dark")} rounded-4 py-0" data-offline-disabled="false">Update</button>
        </div>`,u},renderReply:e=>{let n=document.createElement("div");return n.classList.add("my-2"),n.id=`inner-${e}`,n.innerHTML=`
        <label for="form-inner-${e}" class="form-label my-1" style="font-size: 0.95rem;"><i class="fa-solid fa-reply me-2"></i>Reply</label>
        <textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type reply comment" rows="3" data-offline-disabled="false"></textarea>
        <div class="d-flex flex-wrap justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel('${e}')" class="btn btn-sm btn-outline-${H.isDarkMode("light","dark")} rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.send(this)" data-uuid="${e}" class="btn btn-sm btn-outline-${H.isDarkMode("light","dark")} rounded-4 py-0" data-offline-disabled="false">Send</button>
        </div>`,n},renderLoading:w,renderReadMore:$,renderInnerContent:O,renderContent:e=>M(e,!0),convertMarkdownToHTML:a,maxCommentLength:r}})();var J=window.confetti,te=()=>J.shapeFromPath({path:"M167 72c19,-38 37,-56 75,-56 42,0 76,33 76,75 0,76 -76,151 -151,227 -76,-76 -151,-151 -151,-227 0,-42 33,-75 75,-75 38,0 57,18 76,56z",matrix:[.03333333333333333,0,0,.03333333333333333,-5.566666666666666,-5.533333333333333]});var Q=d=>{let p=Date.now()+25,h=Math.max(.3,Math.min(1,d.getBoundingClientRect().top/window.innerHeight+.2)),l=te(),o=["#FF69B4","#FF1493"];(function m(){o.forEach(r=>{J({particleCount:2,angle:60,spread:55,shapes:[l],origin:{x:0,y:h},zIndex:1057,colors:[r]}),J({particleCount:2,angle:120,spread:55,shapes:[l],origin:{x:1,y:h},zIndex:1057,colors:[r]})}),Date.now()<p&&requestAnimationFrame(m)})()};var W=(()=>{let d=null,p=async o=>{let m=o.firstElementChild,r=o.lastElementChild,w=o.getAttribute("data-uuid"),a=parseInt(m.getAttribute("data-count-like"));o.disabled=!0,d.has(w)?await B(N,"/api/comment/"+d.get(w)).token(T.getToken()).send(A.statusResponse).then(b=>{b.data.status&&(d.unset(w),r.classList.remove("fa-solid","text-danger"),r.classList.add("fa-regular"),m.setAttribute("data-count-like",String(a-1)))}):await B(U,"/api/comment/"+w).token(T.getToken()).send(A.uuidResponse).then(b=>{b.code==201&&(d.set(w,b.data.uuid),r.classList.remove("fa-regular"),r.classList.add("fa-solid","text-danger"),m.setAttribute("data-count-like",String(a+1)))}),m.innerText=m.getAttribute("data-count-like"),o.disabled=!1};return{init:()=>{d=E("likes")},like:p,tapTap:async o=>{if(!navigator.onLine)return;let m=Date.now(),r=m-parseInt(o.getAttribute("data-tapTime")),w=o.id.replace("body-content-",""),a=r<300&&r>0,b=!d.has(w)&&o.getAttribute("data-liked")!=="true";if(a&&b){navigator.vibrate&&navigator.vibrate(100),J&&Q(o);let y=document.querySelector(`[onclick="undangan.comment.like.like(this)"][data-uuid="${w}"]`);o.setAttribute("data-liked","true"),await p(y),o.setAttribute("data-liked","false")}o.setAttribute("data-tapTime",m)}}})();var D=(()=>{let d=10,p=0,h=0,l=null,o=null,m=null,r=null,w=e=>{d=Number(e)},a=()=>d,b=()=>p,y=()=>h,$=()=>o.classList.contains("disabled")?null:o.classList.add("disabled"),c=()=>o.classList.contains("disabled")?o.classList.remove("disabled"):null,s=()=>m.classList.contains("disabled")?null:m.classList.add("disabled"),f=()=>m.classList.contains("disabled")?m.classList.remove("disabled"):null,v=()=>{r.classList.contains("d-none")&&r.classList.remove("d-none")},I=e=>{e.disabled=!0;let n=e.innerHTML;e.innerHTML='<span class="spinner-border spinner-border-sm my-0 mx-1 p-0" style="height: 0.8rem; width: 0.8rem;"></span>';let u=async()=>{await z.comment(),e.disabled=!1,e.innerHTML=n,z.scroll()};return{next:async()=>{p+=d,e.innerHTML="Next"+e.innerHTML,await u(),l.innerText=String(parseInt(l.innerText)+1)},prev:async()=>{p-=d,e.innerHTML=e.innerHTML+"Prev",await u(),l.innerText=String(parseInt(l.innerText)-1)}}};return{init:()=>{r=document.getElementById("pagination"),r.innerHTML=`
        <ul class="pagination mb-2 shadow-sm rounded-4">
            <li class="page-item disabled" id="previous">
                <button class="page-link rounded-start-4" onclick="undangan.comment.pagination.previous(this)" data-offline-disabled="false">
                    <i class="fa-solid fa-circle-left me-1"></i>Prev
                </button>
            </li>
            <li class="page-item disabled">
                <span class="page-link text-light" id="page">1</span>
            </li>
            <li class="page-item" id="next">
                <button class="page-link rounded-end-4" onclick="undangan.comment.pagination.next(this)" data-offline-disabled="false">
                    Next<i class="fa-solid fa-circle-right ms-1"></i>
                </button>
            </li>
        </ul>`,l=document.getElementById("page"),o=document.getElementById("previous"),m=document.getElementById("next")},setPer:w,getPer:a,getNext:b,reset:async()=>p===0?!1:(p=0,h=0,l.innerText=1,s(),$(),await z.comment(),!0),setResultData:e=>{if(h=e,p>0&&c(),h<d){s();return}f(),v()},getResultData:y,previous:async e=>{$(),!(p<0)&&(s(),await I(e).prev())},next:async e=>{s(),!(h<d)&&($(),await I(e).next())}}})();var z=(()=>{let d=null,p=null,h=null,l=null,o=()=>`<div class="text-center p-4 my-2 bg-theme-${H.isDarkMode("dark","light")} rounded-4 shadow"><p class="fw-bold p-0 m-0" style="font-size: 0.95rem;">Yuk bagikan undangan ini biar banyak komentarnya</p></div>`,m=(i,t)=>{document.querySelector(`[data-button-action="${i}"]`).childNodes.forEach(g=>{g.disabled=t})},r=async i=>{if(!confirm("Are you sure?"))return;let t=i.getAttribute("data-uuid");T.isAdmin()&&d.set(t,i.getAttribute("data-own")),m(t,!0);let g=x.disableButton(i),e=document.querySelector(`[onclick="undangan.comment.like.like(this)"][data-uuid="${t}"]`);if(e.disabled=!0,!await B(K,"/api/comment/"+d.get(t)).token(T.getToken()).send(A.statusResponse).then(k=>k.data.status,()=>!1)){g.restore(),e.disabled=!1;return}document.querySelectorAll('a[onclick="undangan.comment.showOrHide(this)"]').forEach(k=>{let L=k.getAttribute("data-uuids").split(",");if(L.find(_=>_===t)){let _=L.filter(C=>C!==t).join(",");_.length===0?k.remove():k.setAttribute("data-uuids",_)}}),d.unset(t),document.getElementById(t).remove();let u=document.getElementById("comments");u.children.length==0&&(u.innerHTML=o())},w=async i=>{let t=i.getAttribute("data-uuid"),g=!1,e=document.getElementById(`form-inner-presence-${t}`);e&&(e.disabled=!0,g=e.value==="1");let n=document.getElementById(`form-${t?`inner-${t}`:"comment"}`),u=!1,k=document.getElementById(`badge-${t}`);if(k&&(u=k.classList.contains("text-success")),t&&x.base64Encode(n.value)===n.getAttribute("data-original")&&u===g){m(t,!1),document.getElementById(`inner-${t}`).remove();return}n.disabled=!0;let L=document.querySelector(`[onclick="undangan.comment.cancel('${t}')"]`);L&&(L.disabled=!0);let _=x.disableButton(i),C=await B(V,"/api/comment/"+d.get(t)).token(T.getToken()).body(A.updateCommentRequest(e?g:null,n.value)).send(A.statusResponse).then(ee=>ee.data.status,()=>!1);if(n.disabled=!1,L&&(L.disabled=!1),e&&(e.disabled=!1),_.restore(),!C)return;m(t,!1),document.getElementById(`inner-${t}`).remove();let P=document.querySelector(`[onclick="undangan.comment.showMore(this, '${t}')"]`),S=R.convertMarkdownToHTML(x.escapeHtml(n.value)),j=document.getElementById(`content-${t}`);if(S.length>R.maxCommentLength?(j.innerHTML=P?.getAttribute("data-show")==="false"?S.slice(0,R.maxCommentLength)+"...":S,j.setAttribute("data-comment",x.base64Encode(S)),P?.style.display==="none"&&(P.style.display="block")):(j.innerHTML=S,j.removeAttribute("data-comment"),P?.style.display==="block"&&(P.style.display="none")),e&&(document.getElementById("form-presence").value=g?"1":"2",E("information").set("presence",g)),!(!e||!k)){if(g){k.classList.remove("fa-circle-xmark","text-danger"),k.classList.add("fa-circle-check","text-success");return}k.classList.remove("fa-circle-check","text-success"),k.classList.add("fa-circle-xmark","text-danger")}},a=async i=>{let t=i.getAttribute("data-uuid"),g=document.getElementById("form-name"),e=g.value;if(T.isAdmin()&&(e=p.get("name")),e.length==0){t&&g.scrollIntoView({behavior:"smooth"}),alert("Silakan masukkan nama Anda.");return}let n=document.getElementById("form-presence");if(!t&&n&&n.value=="0"){alert("Silakan pilih status kehadiran Anda.");return}!t&&g&&!T.isAdmin()&&(g.disabled=!0),n&&n.value!="0"&&(n.disabled=!0);let u=document.getElementById(`form-${t?`inner-${t}`:"comment"}`);u.disabled=!0;let k=document.querySelector(`[onclick="undangan.comment.cancel('${t}')"]`);k&&(k.disabled=!0);let L=x.disableButton(i),_=n?n.value==="1":!0;if(!T.isAdmin()){let P=E("information");P.set("name",e),t||P.set("presence",_)}let C=await B(U,"/api/comment").token(T.getToken()).body(A.postCommentRequest(t,e,_,u.value)).send(A.getCommentResponse).then(P=>P,()=>null);if(g&&(g.disabled=!1),u.disabled=!1,k&&(k.disabled=!1),n&&(n.disabled=!1),L.restore(),!(!C||C.code!==201)){if(d.set(C.data.uuid,C.data.own),u.value=null,!t){if(await D.reset()){M();return}C.data.is_admin=T.isAdmin();let S=document.getElementById("comments");D.setResultData(S.children.length),D.getResultData()==D.getPer()&&S.lastElementChild.remove(),S.innerHTML=R.renderContent(C.data)+S.innerHTML,M()}if(t){l.set("hidden",l.get("hidden").concat([A.commentShowMore(C.data.uuid,!0)])),l.set("show",l.get("show").concat([t])),m(t,!1),document.getElementById(`inner-${t}`).remove(),C.data.is_admin=T.isAdmin(),document.getElementById(`reply-content-${t}`).insertAdjacentHTML("beforeend",R.renderInnerContent(C.data));let P=document.getElementById(`button-${t}`),S=P.querySelector("a"),j=[C.data.uuid];S&&(S.getAttribute("data-show")==="false"&&s(S),S.remove()),P.querySelector(`button[onclick="undangan.comment.like.like(this)"][data-uuid="${t}"]`).insertAdjacentHTML("beforebegin",R.renderReadMore(t,S?S.getAttribute("data-uuids").split(",").concat(j):j))}v(C.data)}},b=i=>{let t=document.getElementById(`form-inner-${i}`),g=!1,e=document.getElementById(`form-inner-presence-${i}`);e&&(g=e.value==="1");let n=!1,u=document.getElementById(`badge-${i}`);u&&(n=u.classList.contains("text-success")),(t.value.length===0||x.base64Encode(t.value)===t.getAttribute("data-original")&&n===g||confirm("Are you sure?"))&&(m(i,!1),document.getElementById(`inner-${i}`).remove())},y=i=>{let t=i.getAttribute("data-uuid");document.getElementById(`inner-${t}`)||(m(t,!0),document.getElementById(`button-${t}`).insertAdjacentElement("afterend",R.renderReply(t)))},$=async i=>{let t=i.getAttribute("data-uuid");if(document.getElementById(`inner-${t}`))return;m(t,!0);let g=x.disableButton(i);await B(q,"/api/comment/"+t).token(T.getToken()).send(A.commentResponse).then(e=>{if(e.code!==200)return;document.getElementById(`button-${t}`).insertAdjacentElement("afterend",R.renderEdit(t,e.data.presence));let n=document.getElementById(`form-inner-${t}`);n.value=e.data.comment,n.setAttribute("data-original",x.base64Encode(e.data.comment))}),g.restore(),i.disabled=!0},c=()=>{let i=document.getElementById("comments");return i.getAttribute("data-loading")==="false"&&(i.setAttribute("data-loading","true"),i.innerHTML=R.renderLoading().repeat(D.getPer())),B(q,`/api/comment?per=${D.getPer()}&next=${D.getNext()}`).token(T.getToken()).send(A.getCommentsResponse).then(t=>{if(D.setResultData(t.data.length),i.setAttribute("data-loading","false"),t.data.length===0)return i.innerHTML=o(),t;let g=(e,n)=>(e.forEach(u=>{n.find(k=>k.uuid===u.uuid)||n.push(A.commentShowMore(u.uuid)),u.comments&&u.comments.length>0&&g(u.comments,n)}),n);return l.set("hidden",g(t.data,l.get("hidden"))),i.innerHTML=t.data.map(e=>R.renderContent(e)).join(""),t.data.forEach(I),t.data.forEach(v),t})},s=i=>{let t=i.getAttribute("data-uuids").split(","),g=i.getAttribute("data-show")==="true",e=i.getAttribute("data-uuid");g?(i.setAttribute("data-show","false"),i.innerText="Show replies",i.innerText+=" ("+t.length+")",l.set("show",l.get("show").filter(n=>n!==e))):(i.setAttribute("data-show","true"),i.innerText="Hide replies",l.set("show",l.get("show").concat([e])));for(let n of t){l.set("hidden",l.get("hidden").map(k=>(k.uuid===n&&(k.show=!g),k)));let u=document.getElementById(n).classList;g?u.add("d-none"):u.remove("d-none")}},f=(i,t)=>{let g=document.getElementById(`content-${t}`),e=x.base64Decode(g.getAttribute("data-comment")),n=i.getAttribute("data-show")==="false";g.innerHTML=n?e:e.slice(0,R.maxCommentLength)+"...",i.innerText=n?"Sebagian":"Selengkapnya",i.setAttribute("data-show",n?"true":"false")},v=i=>{i.comments&&i.comments.forEach(v);let t=document.getElementById(`body-content-${i.uuid}`);t.addEventListener("touchend",()=>W.tapTap(t))},I=i=>{T.isAdmin()&&(i.comments&&i.comments.forEach(I),!(i.ip===void 0||i.user_agent===void 0||i.is_admin||h.has(i.ip))&&fetch(`https://freeipapi.com/api/json/${i.ip}`).then(t=>t.json()).then(t=>{let g=t.cityName+" - "+t.regionName;t.cityName=="-"&&t.regionName=="-"&&(g="localhost"),h.set(i.ip,g),document.getElementById(`ip-${i.uuid}`).innerHTML=`<i class="fa-solid fa-location-dot me-1"></i>${x.escapeHtml(i.ip)} <strong>${g}</strong>`}).catch(t=>{document.getElementById(`ip-${i.uuid}`).innerHTML=`<i class="fa-solid fa-location-dot me-1"></i>${x.escapeHtml(i.ip)} <strong>${x.escapeHtml(t.message)}</strong>`}))},M=()=>document.getElementById("comments").scrollIntoView({behavior:"smooth"});return{like:W,pagination:D,init:()=>{W.init(),R.init(),D.init(),d=E("owns"),p=E("user"),h=E("tracker"),l=E("comment"),l.has("hidden")||l.set("hidden",[]),l.has("show")||l.set("show",[])},scroll:M,cancel:b,send:a,edit:$,reply:y,remove:r,update:w,comment:c,showMore:f,showOrHide:s}})();var Z=(()=>{let d=async()=>{await G.getDetailUser().then(s=>{document.getElementById("dashboard-name").innerHTML=`${x.escapeHtml(s.data.name)}<i class="fa-solid fa-hands text-warning ms-2"></i>`,document.getElementById("dashboard-email").innerHTML=s.data.email,document.getElementById("dashboard-accesskey").value=s.data.access_key,document.getElementById("button-copy-accesskey").setAttribute("data-copy",s.data.access_key),document.getElementById("form-name").value=x.escapeHtml(s.data.name),document.getElementById("filterBadWord").checked=!!s.data.is_filter,document.getElementById("replyComment").checked=!!s.data.can_reply,document.getElementById("editComment").checked=!!s.data.can_edit,document.getElementById("deleteComment").checked=!!s.data.can_delete}),B(q,"/api/stats").token(T.getToken()).send().then(s=>{document.getElementById("count-comment").innerHTML=String(s.data.comments).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-like").innerHTML=String(s.data.likes).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-present").innerHTML=String(s.data.present).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-absent").innerHTML=String(s.data.absent).replace(/\B(?=(\d{3})+(?!\d))/g,".")}),z.comment()},p=async s=>{let f=x.disableCheckbox(s);await B(N,"/api/user").token(T.getToken()).body({filter:!!s.checked}).send(),f.restore()},h=async s=>{let f=x.disableCheckbox(s);await B(N,"/api/user").token(T.getToken()).body({can_reply:!!s.checked}).send(),f.restore()},l=async s=>{let f=x.disableCheckbox(s);await B(N,"/api/user").token(T.getToken()).body({can_edit:!!s.checked}).send(),f.restore()},o=async s=>{let f=x.disableCheckbox(s);await B(N,"/api/user").token(T.getToken()).body({can_delete:!!s.checked}).send(),f.restore()},m=async s=>{if(!confirm("Are you sure?"))return;let f=x.disableButton(s);await B(V,"/api/key").token(T.getToken()).send(A.statusResponse).then(v=>{v.data.status&&d()}),f.restore()},r=async s=>{let f=document.getElementById("old_password"),v=document.getElementById("new_password");if(f.value.length==0||v.value.length==0){alert("Password cannot be empty");return}f.disabled=!0,v.disabled=!0;let I=x.disableButton(s),M=await B(N,"/api/user").token(T.getToken()).body({old_password:f.value,new_password:v.value}).send(A.statusResponse).then(O=>O.data.status,()=>!1);I.restore(),f.disabled=!1,v.disabled=!1,M&&(f.value=null,v.value=null,s.disabled=!0,alert("Success change password"))},w=async s=>{let f=document.getElementById("form-name");if(f.value.length==0){alert("Name cannot be empty");return}f.disabled=!0;let v=x.disableButton(s),I=await B(N,"/api/user").token(T.getToken()).body({name:f.value}).send(A.statusResponse).then(M=>M.data.status,()=>!1);f.disabled=!1,v.restore(),I&&(d(),s.disabled=!0,alert("Success change name"))},a=async s=>{let f=x.disableButton(s);await B(q,"/api/download").token(T.getToken()).download(),f.restore()},b=()=>{let s=document.getElementById("button-change-name");s.disabled&&(s.disabled=!1)},y=()=>{let s=document.getElementById("button-change-password"),f=document.getElementById("old_password");s.disabled&&f.value.length!==0&&(s.disabled=!1)},$=()=>{confirm("Are you sure?")&&G.clearSession()};return{init:()=>{G.init(),H.init(),T.init(),Y.init(),T.isAdmin()||(E("owns").clear(),E("likes").clear(),E("config").clear(),E("comment").clear(),E("session").clear(),E("information").clear()),H.spyTop(),z.init(),document.getElementById("mainModal").addEventListener("hidden.bs.modal",d);try{let s=T.decode()?.exp;if(!s||s<Date.now()/1e3)throw new Error("Invalid token");d()}catch{G.clearSession()}return{util:x,theme:H,comment:z,admin:{auth:G,navbar:X,logout:$,download:a,regenerate:m,editComment:l,replyComment:h,deleteComment:o,changeName:w,changePassword:r,changeFilterBadWord:p,enableButtonName:b,enableButtonPassword:y}}}}})();document.addEventListener("DOMContentLoaded",()=>{window.undangan=Z.init()});})();
